/* Copyright (c) 2014 Intuit Inc. All rights reserved. Unauthorized reproduction is a violation of applicable law. This material contains certain confidential and proprietary information and trade secrets of Intuit Inc. *///>>built
define("qbo/search/GlobalMessagesViewController","dojo/_base/declare dojo/when dojo/on qbo/services/ActivityFeedService neo/util/Destroyable qbo/util/track".split(" "),function(k,f,h,l,m,c){return k(m,{maxRecentMessages:10,initialized:!1,items:[],constructor:function(){this.service=new l;this.activityType="chat"},show:function(a){this.recentMsgList=a;this.getRecentMessages();c.trackPageActivity(c.action.select,"Chat Bubble Clicked",null,c.area.topnav);this.initialized||(this.initialized=!0,this.own(h(this.recentMsgList,
"click",this.recentMessagesNavigate.bind(this))))},updateMessageCount:function(){var a="",a={activityType:this.activityType};f(this.service.getNewChats(a),function(a){a&&this.reflectNewCount(a.count)}.bind(this))},reflectNewCount:function(a){h.emit(document.body,"menus-message-count-change",{bubbles:!0,updateMessageCount:a})},markChatsAsRead:function(a,e){var b=[],d,c,g;g=parseInt(a[0],10);c=parseInt(a[1],10);for(d=0;d<this.items.length;d++)this.items[d].txnId===c&&this.items[d].txnTypeId===g&&b.push(this.items[d].chatId);
if(0<b.length)return f(this.service.markChatsAsRead({txnId:c,txnTypeId:g,chatIds:b})).then(function(){e&&this.getRecentMessages()}.bind(this))},getRecentMessages:function(){var a="",a={activityType:this.activityType};return f(this.service.getNewChats(a)).then(function(a){var b,d="",c=this.maxRecentMessages;this.reflectNewCount(a.count);if(0===a.count)d="\x3cul\x3e\x3cli class\x3d'title'\x3eYou have no new messages\x3c/li\x3e\x3c/ul\x3e",this.recentMsgList.innerHTML=d;else if(this.items=a.chats,"object"===
typeof this.items&&this.items.forEach){this.items.length<c&&(c=this.items.length);d="\x3cul\x3e";for(b=0;b<c;b++)a="target\x3d'"+this.items[b].txnTypeId+"|"+this.items[b].txnId+"'\x3e",d+="\x3cli\x3e\x3ca "+a+"\x3cdiv\x3e\x3cdiv class\x3d'item' "+a+"\x3cspan "+a+this.items[b].refNum+" ("+this.items[b].userName+"): \x3c/span\x3e"+this.items[b].chatText+"\x3c/div\x3e\x3c/div\x3e\x3c/a\x3e\x3c/li\x3e";d+="\x3c/ul\x3e";this.recentMsgList.innerHTML=d}}.bind(this),function(){this.recentMsgList.innerHTML=
"Error"}.bind(this))},recentMessagesNavigate:function(a){var e=a.target.getAttribute("target"),b;"undefined"!==typeof e&&("more"===e?(c.trackPageActivity(c.action.navigate,"chatflyout_morelink",null,c.area.topnav),require(["qbo/base/app"],function(a){qbo.sku.isAccountantSku?a.route("accountant?applyMessageFilter\x3dtrue",{pathForceReload:!0}):a.route("homepage?applyMessageFilter\x3dtrue",{pathForceReload:!0})}.bind(this))):a.target.classList.contains("close-sprite")&&a.target.classList.contains("close-icon")?
(a.target.parentElement.parentElement.hidden=!0,b=e.split("|"),this.markChatsAsRead(b,!0)):(b=e.split("|"),this.markChatsAsRead(b,!1),c.trackPageActivity(c.action.navigate,"chatflyout",{transactiontype:b[0]},c.area.topnav),require(["qbo/base/navigateApp"],function(a){a.navigate(b[0],b[1])}.bind(this))))}})});
//@ sourceMappingURL=GlobalMessagesViewController.js.map